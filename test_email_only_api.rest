### Email-Only Verification System API Tests
### Test the updated authentication system that requires only email verification

@baseUrl = https://localhost:8443/api
@testEmail = test.email.only@example.com
@testPassword = SecurePass123
@managerToken = MANAGER_TOKEN_HERE
@sessionId = SESSION_ID_FROM_STEP1
@userToken = USER_TOKEN_FROM_LOGIN

### 1. Test Start Verification (Email Only)
POST {{baseUrl}}/auth/start-verification
Content-Type: application/json

{
    "username": "test_user_email_only",
    "email": "{{testEmail}}",
    "password": "{{testPassword}}",
    "gender": "Male",
    "role": "Pet owner",
    "phone": "+84123456789",
    "city": "Ho Chi Minh City",
    "address": "123 Test Street"
}

### 2. Test Email Verification (Should Complete Registration)
POST {{baseUrl}}/auth/verify-registration-email
Content-Type: application/json

{
    "sessionId": "{{sessionId}}",
    "emailCode": "123456"
}

### 3. Test Complete Registration (Should Work Immediately After Email)
POST {{baseUrl}}/auth/complete-registration
Content-Type: application/json

{
    "sessionId": "{{sessionId}}"
}

### 4. Test Login (Email Verification Only Required)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
    "email": "{{testEmail}}",
    "password": "{{testPassword}}"
}

### 5. Test Verification Status (Should Show Only Email Status)
GET {{baseUrl}}/auth/verification-status
Authorization: Bearer {{userToken}}

### 6. Test User Profile (Should Show Only Email Verification)
GET {{baseUrl}}/auth/me
Authorization: Bearer {{userToken}}

### 7. Test Registration Without Phone (Should Work)
POST {{baseUrl}}/auth/start-verification
Content-Type: application/json

{
    "username": "test_no_phone",
    "email": "no.phone@example.com",
    "password": "{{testPassword}}",
    "gender": "Female",
    "role": "Service provider",
    "bussiness_name": "Pet Care Services LLC"
}

### 8. Test Service Provider Registration (Phone Optional)
POST {{baseUrl}}/auth/start-verification
Content-Type: application/json

{
    "username": "service_provider_test",
    "email": "provider@example.com",
    "password": "{{testPassword}}",
    "gender": "Other",
    "role": "Service provider",
    "bussiness_name": "Professional Pet Care",
    "description": "Professional pet care services",
    "website": "https://example.com"
}

### 9. Test Manager Registration (No Phone Required)
POST {{baseUrl}}/auth/start-verification
Content-Type: application/json

{
    "username": "manager_test",
    "email": "manager@example.com",
    "password": "{{testPassword}}",
    "gender": "Male",
    "role": "Manager"
}

### 10. Test Resend Verification Code (Email Only)
POST {{baseUrl}}/auth/resend-verification-codes
Content-Type: application/json

{
    "sessionId": "{{sessionId}}"
}

### 11. Test Verification Status for Session
POST {{baseUrl}}/auth/verification-status
Content-Type: application/json

{
    "sessionId": "{{sessionId}}"
}

### 12. Test Legacy Registration (Should Work with Email Only)
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
    "username": "legacy_user",
    "email": "legacy@example.com",
    "password": "{{testPassword}}",
    "gender": "Female",
    "role": "Pet owner",
    "city": "Hanoi",
    "address": "456 Legacy Street"
}

### 13. Test Unverified User Login (Should Fail)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
    "email": "legacy@example.com",
    "password": "{{testPassword}}"
}

### 14. Test Email Verification for Legacy User
POST {{baseUrl}}/auth/verify-email
Authorization: Bearer {{userToken}}
Content-Type: application/json

{
    "code": "123456"
}

### 15. Test Login After Email Verification (Should Succeed)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
    "email": "legacy@example.com",
    "password": "{{testPassword}}"
}

### 16. Test Phone Verification Endpoint (Should Return 404 - Removed)
POST {{baseUrl}}/auth/verify-registration-phone
Content-Type: application/json

{
    "sessionId": "{{sessionId}}",
    "phoneCode": "123456"
}

### 17. Test Resend Phone Verification (Should Return 404 - Removed)
POST {{baseUrl}}/auth/resend-phone-verification
Authorization: Bearer {{userToken}}

### 18. Test Admin Incomplete Registrations
GET {{baseUrl}}/auth/admin/incomplete-registrations
Authorization: Bearer {{managerToken}}

### 19. Test Admin Force Complete Verification
POST {{baseUrl}}/auth/admin/force-complete-verification
Authorization: Bearer {{managerToken}}
Content-Type: application/json

{
    "userId": 1
}

### Expected Results Summary:
### ✅ Registration requires only email verification
### ✅ Phone numbers are optional for all roles
### ✅ Login works with only email_verified = 1
### ✅ No phone verification endpoints exist
### ✅ Verification status shows only email status
### ❌ Phone verification endpoints should return 404
